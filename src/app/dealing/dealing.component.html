<div *ngIf="location" class="glass-container">
  <h3>Dealing in {{ location.name }}</h3>
  
  <div class="location-info">
    <p><strong>Police Activity:</strong> {{ policeHeat }}</p>
    <p><strong>Time Units Left:</strong> {{ timeUnits }}</p>
  </div>

  <div *ngIf="drugs.length === 0" class="info-message">
    <p>You don't have any drugs to sell. Visit the market to stock up!</p>
  </div>

  <ng-container *ngIf="drugs.length > 0">
      <table class="drugs-table">
        <thead>
          <tr>
            <th></th>
            <th>Drug</th>
            <th>Price</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let drug of drugs">
            <td>
              <input type="checkbox" #cb [checked]="selectedDrugIds.has(drug.id)" (change)="toggleDrug(drug.id, cb.checked)" />
            </td>
            <td>{{ drug.name }}</td>
            <td>{{ getSalePrice(drug) | number:'1.0-2' }}</td>
            <td>{{ drug.quantity }}</td>
          </tr>
        </tbody>
      </table>

    <div class="actions">
      <button type="button" (click)="onDeal()">Deal</button>
    </div>
  </ng-container>

  <div *ngIf="dealResult" class="deal-summary glass-container">
    <h3>Deal Summary</h3>
    <table class="buyers-table">
      <thead>
        <tr>
          <th>Drug</th>
          <th>Sold</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let drug of drugs">
          <td>{{ drug.name }}</td>
          <td>{{ dealResult.sold[drug.id] || 0 }}</td>
        </tr>
      </tbody>
    </table>
    <div class="totals">
      <div><strong>Total earned:</strong> ${{ dealResult.totalEarned }}</div>
      <div><strong>Notoriety gained:</strong> {{ dealResult.notorietyGain }}</div>
    </div>
  </div>
</div>
